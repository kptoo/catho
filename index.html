<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catholic Diocese Statistics Map</title>
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" />
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <div id="map"></div>
    
    <!-- Chart Modal -->
    <div id="chart-modal" class="chart-modal">
        <div class="chart-modal-content">
            <div class="chart-modal-header">
                <div class="chart-modal-title-section">
                    <h2 id="modal-diocese-title"></h2>
                    <p id="modal-diocese-subtitle"></p>
                </div>
                <button id="close-modal-btn" class="close-modal-btn">&times;</button>
            </div>
            <div class="chart-modal-body">
                <div id="modal-chart-container"></div>
            </div>
        </div>
    </div>
    
    <div id="controls">
        <div class="controls-header">
            <button id="minimize-controls-btn" class="minimize-btn" title="Minimize panel">−</button>
        </div>
        
        <div id="controls-content">
            <div class="control-panel">
                <div class="panel-header" onclick="togglePanel('region-panel')">
                    <span>Select Region</span>
                    <span class="toggle-icon">▼</span>
                </div>
                <div id="region-panel" class="panel-content">
                    <div class="control-group">
                        <label class="info-label">Filter by Continent:</label>
                        <select id="continent-select" style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; background: #2c3e50; color: #ecf0f1;">
                            <option value="All">All Continents</option>
                            <option value="North America">North America</option>
                            <option value="South America">South America</option>
                            <option value="Europe">Europe</option>
                            <option value="Asia">Asia</option>
                            <option value="Africa">Africa</option>
                            <option value="Oceania">Oceania</option>
                        </select>
                        
                        <label class="info-label">Select Country:</label>
                        <input type="text" id="country-search" placeholder="Type country name..." style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <div id="country-list" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; display: none;"></div>
                        <div id="loaded-countries" style="margin-top: 10px;">
                            <strong>Loaded:</strong>
                            <div id="loaded-countries-list" style="margin-top: 5px;"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="control-panel">
                <div class="panel-header" onclick="togglePanel('statistic-panel')">
                    <span>Select Statistic</span>
                    <span class="toggle-icon">▼</span>
                </div>
                <div id="statistic-panel" class="panel-content">
                    <div class="control-group">
                        <label class="info-label">Heat Map Display:</label>
                        <select id="heatmap-select">
                            <option value="Catholics">Catholics</option>
                            <option value="Total Population">Total Population</option>
                            <option value="Percent Catholic">Percent Catholic</option>
                            <option value="Diocesan Priests">Diocesan Priests</option>
                            <option value="Religious Priests">Religious Priests</option>
                            <option value="Total Priests">Total Priests</option>
                            <option value="Catholics Per Priest">Catholics Per Priest</option>
                            <option value="Permanent Deacons">Permanent Deacons</option>
                            <option value="Male Religious">Male Religious</option>
                            <option value="Female Religious">Female Religious</option>
                            <option value="Parishes">Parishes</option>
                        </select>
                        <div class="info-note">The selected statistic will be shown in the heat map and historical chart</div>
                    </div>
                </div>
            </div>

            <div class="control-panel">
                <div class="panel-header" onclick="togglePanel('search-panel')">
                    <span>Search Diocese</span>
                    <span class="toggle-icon">▼</span>
                </div>
                <div id="search-panel" class="panel-content">
                    <div class="control-group">
                        <input type="text" id="search-input" placeholder="Search by diocese name or country...">
                        <div id="search-results"></div>
                    </div>
                </div>
            </div>
            
            <div id="legend" class="legend"></div>
        </div>
    </div>

    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
    <script>
        function togglePanel(panelId) {
            const panel = document.getElementById(panelId);
            const header = panel.previousElementSibling;
            
            panel.classList.toggle('collapsed');
            header.classList.toggle('collapsed');
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            const minimizeBtn = document.getElementById('minimize-controls-btn');
            const controls = document.getElementById('controls');
            
            minimizeBtn.addEventListener('click', () => {
                controls.classList.toggle('minimized');
                
                if (controls.classList.contains('minimized')) {
                    minimizeBtn.textContent = '+';
                    minimizeBtn.title = 'Maximize panel';
                } else {
                    minimizeBtn.textContent = '−';
                    minimizeBtn.title = 'Minimize panel';
                }
            });
        });
    </script>
    <script src="js/config.js"></script>
    <script src="js/dataLoader.js"></script>
    <script src="js/dataProcessor.js"></script>
    <script src="js/arcgisApiLoader.js"></script>
    <script src="js/mapManager.js"></script>
    <script src="js/heatmapRenderer.js"></script>
    <script src="js/chartRenderer.js"></script>
    <script src="js/chartModal.js"></script>
    <script src="js/searchManager.js"></script>
    <script src="js/app.js"></script>
</body>
</html>